<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>文章列表-星云号</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link rel="stylesheet" type="text/css" href="http://static.anman.org/nphot/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="http://static.anman.org/nphot/css/nprogress.css">
    <link rel="stylesheet" type="text/css" href="http://static.anman.org/nphot/css/styles.css">
    <link rel="stylesheet" type="text/css" href="http://static.anman.org/nphot/css/font-awesome.min.css">
    <link rel="apple-touch-icon-precomposed" href="http://static.anman.org/nphot/images/icon.png">
    <link rel="shortcut icon" href="http://static.anman.org/nphot/images/favicon.ico">
    <script src="http://static.anman.org/nphot/js/jquery-2.1.4.min.js"></script>
    <script src="http://static.anman.org/nphot/js/nprogress.js"></script>
    <script src="http://static.anman.org/nphot/js/jquery.lazyload.min.js"></script>
    <!--[if gte IE 9]>
    <script src="http://static.anman.org/nphot/js/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="http://static.anman.org/nphot/js/html5shiv.min.js" type="text/javascript"></script>
    <script src="http://static.anman.org/nphot/js/respond.min.js" type="text/javascript"></script>
    <script src="http://static.anman.org/nphot/js/selectivizr-min.js" type="text/javascript"></script>
    <![endif]-->
    <!--[if lt IE 9]>
    <script>window.location.href = 'upgrade-browser.html';</script>
    <![endif]-->
    <style type="text/css">
        body {
            word-break: break-all;
        }

        .noExtension {
            margin: auto;
            font-size: 23px;
        }
    </style>
</head>
<body class="user-select">
<header class="header">
    <nav class="navbar navbar-default" id="navbar">
        <div class="container">
            <div class="header-topbar hidden-xs link-border">
                <ul class="site-nav topmenu">
                    <!--<li><a href="users.html">作者墙</a></li>-->
                    <li><a href="rss.html" title="RSS订阅">
                        <i class="fa fa-rss">
                        </i> RSS订阅
                    </a></li>
                </ul>
                YES,WE BELIEVE
            </div>
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                        data-target="#header-navbar" aria-expanded="false"><span class="sr-only"></span> <span
                        class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button>
                <h1 class="logo hvr-bounce-in"><a href="http://www.nphot.com/" title="星云号"><img
                        src="http://static.anman.org/nphot/images/logo.png" alt="星云号"></a></h1>
            </div>
            <div class="collapse navbar-collapse" id="header-navbar">
                <form class="navbar-form visible-xs" action="/Search" method="post">
                    <div class="input-group">
                        <input type="text" name="keyword" class="form-control" placeholder="请输入关键字" maxlength="20"
                               autocomplete="off">
                        <span class="input-group-btn">
            <button class="btn btn-default btn-search" name="search" type="submit">搜索</button>
            </span></div>
                </form>
                <ul class="nav navbar-nav navbar-right">
                    <li><a data-cont="星云号" title="星云号" href="index.html">首页</a></li>
                    <li><a data-cont="文章列表" title="文章列表" href="articles.html">文章列表</a></li>
                    <li><a data-cont="作者列表" title="作者列表" href="users.html">作者列表</a></li>
                    <li><a data-cont="作者注册" title="作者注册" href="user_reg.html">作者注册</a></li>
                    <li><a data-cont="发布文章" title="发布文章" href="addarticle.html">发布文章</a></li>
                    <li><a data-cont="Nebulas" title="Nebulas" href="https://nebulas.io">Nebulas</a></li>
                </ul>
            </div>
        </div>
    </nav>
</header>
<section id="noExtensions" style="margin-top:1px;padding-bottom: 0px;background-color:red; color:#fff;display: none;">
    <div class="container">
        <div class="row">
            <div class="noExtension col-md-12" id="noExtension">
                注意: 请安装谷歌浏览器扩展<a target="_blank" href="https://github.com/ChengOrangeJu/WebExtensionWallet">WebExtensionWallet</a>
            </div>
        </div>
    </div>
</section>
<section class="container">
    <div class="content-wrap">
        <div class="content">
            <div class="title">
                <h3 style="line-height: 1.3">星云号</h3>
            </div>
            <div id="articles">

            </div>
            <nav>
                <ul class="pager" id="pager">

                </ul>
            </nav>
        </div>
    </div>
    <aside class="sidebar">
        <div class="fixed">
            <div class="widget widget-tabs">
                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#notice" aria-controls="notice" role="tab"
                                                              data-toggle="tab" draggable="false">统计信息</a></li>
                    <li role="presentation"><a href="#contact" aria-controls="contact" role="tab" data-toggle="tab"
                                               draggable="false">联系我</a></li>
                </ul>
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane contact active" id="notice">
                        <h2 id="articletotal">
                        </h2>
                        <h2>合约启动:
                            <span id="starttime"></span></h2>
                    </div>
                    <div role="tabpanel" class="tab-pane contact" id="contact">
                        <h2>Github:<a href="https://github.com/luoam">https://github.com/luoam</a> </h2>
                        <h2>Email:
                            <a href="mailto:xiaoman.whu@foxmail.com" target="_blank" data-toggle="tooltip" rel="nofollow"
                               data-placement="bottom" title="" draggable="false"
                               data-original-title="Email:xiaoman.whu@foxmail.com">xiaoman.whu@foxmail.com</a></h2>

                    </div>
                </div>
            </div>
            <div class="widget widget_search">
                <form class="navbar-form" action="/Search" method="post">
                    <div class="input-group">
                        <input type="text" name="keyword" class="form-control" size="35" placeholder="请输入关键字"
                               maxlength="15" autocomplete="off">
                        <span class="input-group-btn">
            <button class="btn btn-default btn-search" name="search" type="submit">搜索</button>
            </span></div>
                </form>
            </div>
        </div>
        <div class="widget widget_hot">
            <h3>最新点赞文章</h3>
            <ul id="latestzan">



            </ul>
        </div>

    </aside>
</section>
<footer class="footer">
    <div class="container">
        <p>星云号[<a href="http://www.nphot.com">www.nphot.com</a> ]由星云链[<a href="https://nebulas.io" target="_blank"
                                                                         rel="nofollow">Nebulas</a>] 驱动.<a
                href="http://www.miitbeian.gov.cn/" target="_blank" rel="nofollow">浙ICP备14037650号</a> &nbsp; <a
                href="http://www.nphot.com/sitemap.xml" target="_blank" class="sitemap">网站地图</a></p>
    </div>
    <!--<div id="gotop"><a class="gotop"></a></div>-->
</footer>
<script src="http://static.anman.org/nphot/js/bootstrap.min.js"></script>
<script src="http://static.anman.org/static/bootstrap/js/bootbox.min.js"></script>
<script src="http://static.anman.org/static/bootstrap/js/nebulas.js"></script>
<script src="http://static.anman.org/static/bootstrap/js/nebPay.js"></script>
<script src="seed.js"></script>
<script src="initcall.js"></script>
<script type="text/javascript">
    if (typeof(webExtensionWallet) === "undefined") {
        $("#noExtensions").show();
    }
    var Amount = 0;

    var NebPay = require("nebpay");     //https://github.com/nebulasio/nebPay
    var nebPay = new NebPay();
    var id;
    var account;
    $(document).ready(function () {
        Date.prototype.Format = function (fmt) { //author: meizz
            var o = {
                "M+": this.getMonth() + 1, //月份
                "d+": this.getDate(), //日
                "H+": this.getHours(), //小时
                "m+": this.getMinutes(), //分
                "s+": this.getSeconds(), //秒
                "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                "S": this.getMilliseconds() //毫秒
            };
            if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o)
                if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            return fmt;
        };
        $.extend({
            getUrlVars: function () {
                var vars = [], hash;
                var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
                for (var i = 0; i < hashes.length; i++) {
                    hash = hashes[i].split('=');
                    vars.push(hash[0]);
                    vars[hash[0]] = hash[1];
                }
                return vars;
            },
            getUrlVar: function (name) {
                return $.getUrlVars()[name];
            }
        });

        //step3
        let page = $.getUrlVar('page');
        page = parseInt(page);
        if(!page){
            page =0;
        }
        if (page<0){
            page=0;
        }

        let pager = "<li><a href=\"articles.html?page="+(page-200)+"\">上一页</a></li>" +
            "                    <li><a href=\"articles.html?page="+(page+200)+"\">下一页</a></li>";
        $("#pager").html(pager);

        initCall(function (params) {
            console.log(params);
            var tmp = [];
            tmp.push(200);
            tmp.push(page);
            var callArgs = JSON.stringify(tmp);
            neb.api
                .call({
                    from: params.from,
                    to: params.to,
                    value: params.value,
                    nonce: params.nonce,
                    gasPrice: params.gasPrice,
                    gasLimit: params.gasLimit,
                    contract: {
                        "function": "getarticlelist",
                        "args": callArgs
                    }
                })
                .then(function (resp) {
                    console.log("callback resp: " + resp);
                    if (resp.execute_err) {
                        bootbox.dialog({
                            backdrop: true,
                            onEscape: true,
                            message: resp.execute_err,
                            size: "large",
                            title: "Error"
                        });

                    } else {
                        let result_total = JSON.parse(resp.result);
                        let result = result_total.result;
                        console.log("aaaaa");
                        console.log(result);
                        if (result.length === 0) {
                            console.log("没有信息");
                        } else {

                            let str = "";
                            for (let i = 0; i < result.length; i++) {
                                let item = result[i];
                                if (!item.image){
                                    item.image = "http://static.anman.org/nphot/images/leftlogo.png";
                                }
                                str = "<article class=\"excerpt excerpt-1\"><a class=\"focus\" href=\"article.html?id="+item.id+"\" title=\""+item.title+"\" target=\"_self\" >" +
                                    "<img class=\"thumb\" data-original=\""+item.image+"\" src=\""+item.image+"\" alt=\""+item.title+"\"  style=\"display: inline;\"></a>" +
                                    "                <header><a class=\"cat\" href=\"http://www.nphot.com\" title=\"星云号\" >星云号<i></i></a>" +
                                    "                    <h2><a href=\"article.html?id="+item.id+"\" title=\""+item.title+"\" target=\"_self\" >"+item.title+"</a></h2>" +
                                    "                </header>" +
                                    "                <p class=\"meta\">" +
                                    "                    <time class=\"time\"><i class=\"glyphicon glyphicon-time\"></i>"+showtime(item.timestamp)+"</time>" +
                                    "                <p class=\"note\">"+item.summary+"</p>" +
                                    "            </article>";
                                $("#articles").append(str);
                            }
                        }

                    }
                })
                .catch(function (err) {

                    console.log(JSON.stringify(err));
                });
        });


        function showtime(t) {
            var newDate = new Date();
            newDate.setTime(t);
            console.log(newDate.toLocaleString());
            return newDate.Format("yyyy年MM月dd日 HH:mm");
        }
        //step5
        initCall(function (params) {
            console.log(params);
            var tmp = [];
            tmp.push(8);
            var callArgs = JSON.stringify(tmp);
            neb.api
                .call({
                    from: params.from,
                    to: params.to,
                    value: params.value,
                    nonce: params.nonce,
                    gasPrice: params.gasPrice,
                    gasLimit: params.gasLimit,
                    contract: {
                        "function": "getlatestzan",
                        "args": callArgs
                    }
                })
                .then(function (resp) {
                    console.log("callback resp: " + resp);
                    if (resp.execute_err) {
                        bootbox.dialog({
                            backdrop: true,
                            onEscape: true,
                            message: resp.execute_err,
                            size: "large",
                            title: "Error"
                        });

                    } else {
                        let result = JSON.parse(resp.result);
                        console.log(result);
                        if (result.length === 0) {
                            console.log("没有信息");
                        } else {
                            let str = "";
                            for (let i = 0; i < result.length; i++) {
                                let item = result[i];
                                console.log(item);
                                let str_image="";
                                if (item.image){
                                    str_image = item.image;
                                } else{
                                    str_image = "http://static.anman.org/nphot/images/leftlogo.png";
                                }
                                str = "<li>" +
                                    "                    <a title=\""+item.title+"\" href=\"article.html?id="+item.id+"\">" +
                                    "                        <span class=\"thumbnail\">" +
                                    "                            <img class=\"thumb\" data-original=\""+str_image+"\" src=\""+str_image+"\" alt=\""+item.title+"\"" +
                                    "                                 style=\"display: block;\">" +
                                    "                        </span>" +
                                    "                        <span class=\"text\">"+item.title+"</span>" +
                                    "                        <span class=\"muted\"><i class=\"glyphicon glyphicon-time\"></i>"+showtime(item.timestamp)+"<br>"+(item.summary).substring(0,40)+"</span>" +
                                    "                    </a>" +
                                    "                </li>";
                                $("#latestzan").append(str);
                            }


                        }

                    }
                })
                .catch(function (err) {

                    console.log(JSON.stringify(err));
                });
        });

        //step6
        initCall(function (params) {
            console.log(params);
            var tmp = [];
            var callArgs = JSON.stringify(tmp);
            neb.api
                .call({
                    from: params.from,
                    to: params.to,
                    value: params.value,
                    nonce: params.nonce,
                    gasPrice: params.gasPrice,
                    gasLimit: params.gasLimit,
                    contract: {
                        "function": "getarticletotal",
                        "args": callArgs
                    }
                })
                .then(function (resp) {
                    console.log("callback resp: " + resp);
                    if (resp.execute_err) {
                        bootbox.dialog({
                            backdrop: true,
                            onEscape: true,
                            message: resp.execute_err,
                            size: "large",
                            title: "Error"
                        });

                    } else {
                        let result = JSON.parse(resp.result);
                        console.log(result);
                        let str ="";
                        str = "日志总数:"+result+"篇";
                        $("#articletotal").html(str);

                    }
                })
                .catch(function (err) {

                    console.log(JSON.stringify(err));
                });
        });

        //step7
        initCall(function (params) {
            console.log(params);
            var tmp = [];
            var callArgs = JSON.stringify(tmp);
            neb.api
                .call({
                    from: params.from,
                    to: params.to,
                    value: params.value,
                    nonce: params.nonce,
                    gasPrice: params.gasPrice,
                    gasLimit: params.gasLimit,
                    contract: {
                        "function": "getstarttime",
                        "args": callArgs
                    }
                })
                .then(function (resp) {
                    console.log("callback resp: " + resp);
                    if (resp.execute_err) {
                        bootbox.dialog({
                            backdrop: true,
                            onEscape: true,
                            message: resp.execute_err,
                            size: "large",
                            title: "Error"
                        });

                    } else {
                        let result = JSON.parse(resp.result);
                        console.log(result);
                        $("#starttime").html(showtime(result));

                    }
                })
                .catch(function (err) {

                    console.log(JSON.stringify(err));
                });
        });
    });
</script>
</body>
</html>
